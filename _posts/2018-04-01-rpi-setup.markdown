---
layout: post
title:  "Light-Weight Demonstration RPi Based Platform"
date:   2018-04-01 09:50:00 (MSK)
categories: pi
---

```
   .~~.   .~~.    Sunday,  1 April 2018, 08:31:42 AM
  '. \ ' ' / .'   Raspberry Pi 3
   .~ .~~~..~.
  : .~.'~'.~. :   Purpose: Light-Weight Demonstration Platform
 ~ (   ) (   ) ~  Interfacing Options: SSH & VNC
( : '~'.~.'~' : ) Features:
 ~ .~ (   ) ~. ~    * Ad Hoc Creation At Launch
  (  : '~' :  )     * Python with SciPy
   '~ .~~~. ~'
       '~'
```

- [Introduction](#introduction)
- [Install Raspbian](#install-raspbian)
- [Security First](#security-first)
- [Interfacing](#interfacing)
- [Ad Hoc Network Setup](#ad-hoc-setup)
- [Install SciPy](#install-scipy)

## Introduction

There are plenty of possible uses for Pi, e.g.: smart house control, electronics modules invention, cloud service, computer vision system, local web-server and many others... Actually I would like to configure my Pi for every listed purpose, however the most practical use for me right now is to build a light-weight demonstration platform to show the progress of my research project development. The idea is to bring the Pi and a tablet/phone to a meeting, launch pi with [ad hoc network](https://en.wikipedia.org/wiki/Wireless_ad_hoc_network) and connect to it with tablet via [VNC](https://www.realvnc.com/en/). Well, why not to use a notebook? The Pi with a tablet are just the only suitable way. This post is dedicated to build such demonstration platform from scratch.

## Install Raspbian

I have selected [Raspbian OS](https://www.raspberrypi.org/downloads/) as it is made for Pi, has Python, Git, SSH and VNC preinstalled. The quickest way to install Raspbian is doing it with [Noobs](https://www.raspberrypi.org/downloads/noobs/). To install Noobs the first thing to do is to format the Pi's SD card with [SD Formatter](https://www.sdcard.org/downloads/formatter_4) (for macOS or Windows) or `GParted` for Linux. Then the content of Noobs must be extracted to SD card. After launching Pi by connecting it to power, all that left to do is just to follow the instructions.

## Security First

Some basic security measures need to be handled first so no one else could connect to the Pi.

#### I. Changing the password

1. Start configuration menu in terminal: `sudo raspi-config`

2. Select `2. Change User Password` and enter new password for **pi** user

#### II. Regenerating SSH keys

Run the following commands in terminal:

```
sudo rm /etc/ssh/ssh_host_*
sudo dpkg-reconfigure openssh-server
sudo service ssh restart
```

## Interfacing

`SSH` and `VNC` are disabled by default, so let's enable them with the following actions:

1. Run `sudo raspi-config` and select `5. Interfacing Options`

2. Enable `SSH` and `VNC`

## Ad Hoc Setup

To connect to Pi without any network infrastructure available the Ad Hoc Network creation need to be setup.

Make a backup of the network interfaces file and open in in editor, e.g. vi:

```
sudo cp /etc/network/interfaces /etc/network/interfaces.orig
sudo vi /etc/network/interfaces
```

Replace the file content with the following lines:

```
source-directory /etc/network/interfaces.d

auto lo
iface lo inet loopback

allow-hotplug eth0
iface eth0 inet dhcp

auto wlan0
iface wlan0 inet static
  address 10.0.1.1
  netmask 255.255.255.0
  wireless-channel 1
  wireless-essid PiAdHoc
  wireless-mode ad-hoc
```

Then the Raspberry Pi  need to be configured as a DHCP server so it can assign IP addresses to clients that connect to it's ad hoc network.

```
sudo apt-get update
sudo apt-get install isc-dhcp-server
```

Once installation finishes (likely with error messages), we just need to configure the DHCP server. The default configuration file is located at `/etc/dhcp/dhcpd.conf`.

The file must be updated with the following content:

```
ddns-update-style standard;
default-lease-time 600;
max-lease-time 7200;
authoritative;

subnet 10.0.1.0 netmask 255.255.255.0 {
  range 10.0.1.2 10.0.1.20;
}
```

Verify it by rebooting Pi:

```
sudo reboot
```

The expected result is to be able to connect to Pi directly by connecting to wireless ad hoc.

To connect through Ad Hoc first select `PiAdHoc` network from the list of available networks on tablet/phone or notebook. Then launch VNC Viewer and add new connection with the following ip: `10.0.1.1`.

### Install SciPy

To install `SciPy` the following prerequisites need to be installed first:

* A BLAS/LAPACK math library with development headers: `libblas-dev`, `liblapack-dev`
* Python development headers: `python-dev`
* Fortran compiler: `gfortran`

```
sudo apt-get install libblas-dev liblapack-dev python-dev  gfortran
```

More swap is required for building `SciPy`, so letâ€™s add 1GB of swap space:

1. Make a copy: `sudo cp /etc/dphys-swapfile /etc/dphys-swapfile.orig`
2. `sudo vi /etc/dphys-swapfile`
3. The default value in Raspbian is: `CONF_SWAPSIZE=100`
4. Change it to 1024 Mb: `CONF_SWAPSIZE=1024`
5. Restart swap manager:
  ```
  sudo /etc/init.d/dphys-swapfile stop
  sudo /etc/init.d/dphys-swapfile start
  ```

Install `SciPy` with the following command:

`sudo -H pip install --verbose scipy`

Now the additional swap could be removed:

```
sudo mv /etc/dphys-swapfile.orig /etc/dphys-swapfile
sudo /etc/init.d/dphys-swapfile stop
sudo /etc/init.d/dphys-swapfile start
```

Light-Weight Demonstration Raspberry Pi Based Platform is configured!